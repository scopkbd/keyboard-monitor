# GUI版開発計画書

## 概要

キーボードモニターのGUI版開発の詳細計画書です。フェーズ1のコンソール版の機能をベースに、視覚的で使いやすいデスクトップアプリケーションを開発します。

## 技術仕様

### 開発環境
- **言語**: Python 3.8+
- **GUIフレームワーク**: CustomTkinter
- **グラフ描画**: matplotlib + tkinter integration
- **システム統合**: pystray (システムトレイ)
- **テーマ**: Dark/Light モード対応

### アーキテクチャ
```
├── gui/
│   ├── main_window.py          # メインアプリケーション
│   ├── app_controller.py       # アプリケーション制御
│   ├── components/
│   │   ├── dashboard.py        # ダッシュボード画面
│   │   ├── statistics_view.py  # 統計表示画面
│   │   ├── settings_panel.py   # 設定パネル
│   │   ├── real_time_display.py # リアルタイム表示
│   │   ├── analytics/          # 分析画面コンポーネント
│   │   │   ├── analytics_page.py        # メイン分析ページ
│   │   │   ├── basic_stats_card.py      # 基本統計カード
│   │   │   ├── key_frequency_card.py    # キー頻度分析カード
│   │   │   ├── modifier_analysis_card.py # モディファイア分析カード
│   │   │   ├── integrated_sequence_card.py # 統合シーケンス分析カード
│   │   │   └── data_analyzer.py         # データ分析ロジック
│   │   └── charts/
│   │       ├── key_frequency_chart.py
│   │       ├── typing_pattern_chart.py
│   │       ├── efficiency_chart.py
│   │       └── heatmap_chart.py
│   ├── styles/
│   │   ├── themes.py          # カラーテーマ定義
│   │   ├── custom_widgets.py  # カスタムウィジェット
│   │   └── icons/             # アイコンリソース
│   └── utils/
│       ├── gui_config.py      # GUI設定管理
│       ├── chart_utils.py     # グラフ描画ユーティリティ
│       └── system_tray.py     # システムトレイ管理
```

## Phase 2.1: 基本GUIフレームワーク

### 目標
モダンで直感的なGUIの基盤を構築する

### 実装項目

#### 1. 依存関係の追加
```bash
pip install customtkinter
pip install matplotlib
pip install pystray
pip install Pillow
```

#### 2. メインウィンドウの設計
- **ウィンドウサイズ**: 1200x800px（最小サイズ: 800x600px）
- **レイアウト**:
  - 左サイドバー: ナビゲーションメニュー
  - メインエリア: 動的コンテンツ表示
  - 下部ステータスバー: リアルタイム情報

#### 3. ナビゲーション構造
```
🏠 ダッシュボード
   ├── リアルタイム統計
   ├── 記録状況
   └── クイック操作

📊 統計・分析
   ├── 基本統計
   ├── キー使用頻度
   ├── タイピング効率
   └── シーケンス分析

📈 グラフ表示
   ├── リアルタイムグラフ
   ├── 履歴グラフ
   └── ヒートマップ

⚙️ 設定
   ├── 記録設定
   ├── 表示設定
   ├── 通知設定
   └── エクスポート設定
```

#### 4. テーマシステム
- **Darkテーマ**: メイン使用、目に優しい
- **Lightテーマ**: 明るい環境での使用
- **カスタムカラー**: アクセントカラーの変更可能

### Phase 2.1 成果物
- [ ] 基本ウィンドウ構造
- [ ] ナビゲーションシステム
- [ ] テーマ切り替え機能
- [ ] 既存CLIとの統合

## Phase 2.2: コア機能GUI化

### 目標
既存のCLI機能をGUIで操作可能にする

### 実装項目

#### 1. 記録制御UI
- **開始/停止ボタン**: 大きく分かりやすい制御
- **状態表示**: 記録中/停止中の視覚的表示
- **セッション情報**: 開始時刻、経過時間、キーストローク数

#### 2. リアルタイム表示パネル
```
┌─────────────────────────────────────┐
│ 📊 リアルタイム統計                 │
├─────────────────────────────────────┤
│ セッション: 1,234 キーストローク    │
│ 総計: 15,678 キーストローク         │
│ 効率: ██████████ 78%               │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ 🔥 現在のホットキー                 │
├─────────────────────────────────────┤
│ 1. Space    ████████ 23.4%         │
│ 2. E        ██████   15.6%         │
│ 3. T        █████    12.1%         │
└─────────────────────────────────────┘
```

#### 3. システムトレイ統合
- **最小化時**: システムトレイに格納
- **クイックメニュー**: 右クリックで基本操作
- **通知**: 重要なイベントの通知

### Phase 2.2 成果物
- [ ] 記録制御GUI
- [ ] リアルタイム情報表示
- [ ] システムトレイ機能
- [ ] 基本通知システム

## Phase 2.3: 高度な視覚化

### 目標
データを美しく分かりやすいグラフで表示する

### 実装項目

#### 1. キーストローク頻度グラフ
- **棒グラフ**: 使用頻度ランキング
- **円グラフ**: 割合表示
- **時系列グラフ**: 時間別使用パターン

#### 2. タイピング効率チャート
- **ヒートマップ**: キーボード配列での使用頻度
- **効率スコア**: ホームポジション使用率の可視化
- **改善提案**: 視覚的な改善点表示

#### 3. インタラクティブ機能
- **期間選択**: 特定期間のデータ表示
- **フィルタリング**: 特定のキーやパターンに絞り込み
- **ズーム**: グラフの詳細表示

### Phase 2.3 成果物
- [ ] 各種グラフ表示機能
- [ ] インタラクティブ操作
- [ ] データフィルタリング
- [ ] グラフエクスポート機能

## Phase 2.4: 詳細設定とカスタマイズ

### 目標
ユーザーの多様なニーズに対応する設定機能

### 実装項目

#### 1. 詳細設定GUI
- **記録設定**: 除外アプリ、記録間隔
- **表示設定**: テーマ、フォント、レイアウト
- **通知設定**: アラート、レポート通知

#### 2. プロファイル管理
- **複数プロファイル**: 用途別設定
- **自動切り替え**: 時間や状況による自動変更
- **共有機能**: 設定のエクスポート/インポート

#### 3. 自動化機能
- **自動起動**: Windows起動時の自動開始
- **スケジュール**: 定期的なレポート生成
- **メンテナンス**: 自動データクリーンアップ

### Phase 2.4 成果物
- [ ] 包括的設定画面
- [ ] プロファイル機能
- [ ] 自動化・スケジュール機能
- [ ] 設定のバックアップ・復元

## Phase 2.5: 仕上げと最適化

### 目標
プロフェッショナルレベルのアプリケーションとして完成させる

### 実装項目

#### 1. パフォーマンス最適化
- **メモリ使用量最適化**: 長時間動作対応
- **CPU負荷軽減**: 効率的な更新処理
- **起動時間短縮**: 必要最小限の初期化

#### 2. ユーザビリティ向上
- **ヘルプシステム**: 内蔵ヘルプとチュートリアル
- **ショートカットキー**: キーボード操作対応
- **アクセシビリティ**: 視覚障害者対応

#### 3. 配布準備
- **インストーラー**: 一般ユーザー向けセットアップ
- **自動更新**: アプリケーション更新機能
- **ドキュメント**: ユーザーマニュアル整備

### Phase 2.5 成果物
- [ ] パフォーマンス最適化
- [ ] ヘルプ・ドキュメント
- [ ] インストーラー
- [ ] 配布パッケージ

## Phase 2.6: 統合分析画面（新規追加）

### 目標
包括的なキーボード使用分析を視覚的に表示する統合画面を実装する

### 実装項目

#### 1. 分析画面のレイアウト構成
```
┌─────────────────────────────────────────────────────────────┐
│ 📈 キーボード使用統計                                        │
├─────────────────────────────────────────────────────────────┤
│ [統計更新] [データエクスポート]                              │
├─────────────────────────────────────────────────────────────┤
│ ┌─基本情報──────┐ ┌─上位キー──────┐ ┌─モディファイア詳細─┐ │
│ │総ストローク    │ │1. Space: 156回│ │Ctrl+C: 15回       │ │
│ │記録期間       │ │2. Enter: 94回 │ │Ctrl+V: 12回       │ │
│ │記録日数       │ │3. S: 95回     │ │Ctrl+S: 8回        │ │
│ │1日平均        │ │4. D: 80回     │ │合計修飾キー使用率  │ │
│ └──────────────┘ │5. T: 70回     │ └─────────────────┘ │
│                   └──────────────┘                     │
├─────────────────────────────────────────────────────────────┤
│ ┌─統合シーケンス分析（キー中心の前後関係マップ）─────────────┐ │
│ │⬅️ 直前キー        🎯 メインキー        ➡️ 直後キー       │ │
│ │                                                        │ │
│ │┌─────────────┐  ┌─────────────┐  ┌─────────────┐│ │
│ ││[S]の直前：    │  │1位: S (95回) │  │[S]の直後：    ││ │
│ ││1.Enter: 8回   │  │ ⬅️─[S]─➡️    │  │1.Space: 12回  ││ │
│ ││2.T: 6回      │  │             │  │2.Enter: 8回   ││ │
│ ││3.I: 4回      │  │             │  │3.H: 5回      ││ │
│ │└─────────────┘  └─────────────┘  └─────────────┘│ │
│ │（上位5キーについて同様の表示）                          │ │
│ └────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

#### 2. 基本統計カード
- **総キーストローク数**: 記録開始からの累計
- **記録期間**: first_record_date ～ last_record_date
- **記録日数**: 日付差分による算出
- **1日平均**: 総ストローク数 ÷ 記録日数

#### 3. 上位キー分析カード
- **使用頻度ランキング**: count値による降順ソート
- **使用率表示**: 各キーの全体に対する割合
- **視覚的表示**: 棒グラフまたはプログレスバー形式

#### 4. モディファイア詳細カード
- **ショートカット使用統計**: Ctrl+C, Ctrl+V等の頻出組み合わせ
- **修飾キー使用率**: none vs shift vs ctrl vs alt の比率
- **修飾キー別ランキング**: 各修飾キーと組み合わせて使用されるキーのランキング

#### 5. 統合シーケンス分析カード
- **3列レイアウト**: 直前キー | メインキー | 直後キー
- **上位5キー対象**: 使用頻度の高いキーに絞った分析
- **前後関係マップ**: 各キーへの「入力経路」と「出力先」を可視化
- **動的更新**: データ変更時の自動反映

#### 6. データ分析ロジック
```python
# 主要な分析関数
def calculate_basic_stats(data)          # 基本統計計算
def analyze_key_frequency(data)          # キー頻度分析
def analyze_modifier_usage(data)         # モディファイア使用分析
def create_integrated_sequence_analysis(data)  # 統合シーケンス分析
def get_top_predecessors(key_code, top_n=3)    # 直前キー分析
def get_top_successors(key_code, top_n=3)      # 直後キー分析
```

#### 7. UIコンポーネント設計
- **カードベースレイアウト**: 情報を整理したカード形式
- **レスポンシブデザイン**: ウィンドウサイズに応じた調整
- **テーマ対応**: ダーク/ライトモード完全対応
- **エクスポート機能**: JSON/CSV形式でのデータ出力

### Phase 2.6 実装ファイル
- `gui/components/analytics/analytics_page.py` - メイン分析ページ
- `gui/components/analytics/basic_stats_card.py` - 基本統計カード
- `gui/components/analytics/key_frequency_card.py` - キー頻度カード
- `gui/components/analytics/modifier_analysis_card.py` - モディファイア分析カード
- `gui/components/analytics/integrated_sequence_card.py` - 統合シーケンス分析カード
- `gui/components/analytics/data_analyzer.py` - データ分析ロジック
- `gui/components/analytics_manager.py` - 分析データ管理

### Phase 2.6 成果物
- [ ] 基本統計表示機能
- [ ] キー使用頻度分析
- [ ] モディファイア詳細分析
- [ ] 統合シーケンス分析
- [ ] データエクスポート機能
- [ ] メインウィンドウへの統合

## 開発スケジュール

### 推定期間
- **Phase 2.1**: 1-2週間
- **Phase 2.2**: 2-3週間
- **Phase 2.3**: 3-4週間
- **Phase 2.4**: 2-3週間
- **Phase 2.5**: 1-2週間
- **Phase 2.6**: 3-4週間

**総期間**: 約3-4ヶ月

## 品質保証

### テスト戦略
- **ユニットテスト**: GUI コンポーネント単体テスト
- **統合テスト**: GUI-CLI連携テスト
- **ユーザビリティテスト**: 実際の使用シナリオテスト
- **パフォーマンステスト**: 長時間使用テスト

### 成功指標
- [ ] 既存CLI機能の完全GUI化
- [ ] 5秒以内の起動時間
- [ ] 24時間連続動作の安定性
- [ ] 直感的な操作（初回使用でもマニュアル不要）

## リソース要件

### 開発リソース
- **追加依存関係**: CustomTkinter, matplotlib, pystray
- **アセット**: アイコン、画像リソース
- **ドキュメント**: GUI操作マニュアル

### システム要件
- **最小**: Windows 10, Python 3.8, 4GB RAM
- **推奨**: Windows 11, Python 3.10+, 8GB RAM, SSD
