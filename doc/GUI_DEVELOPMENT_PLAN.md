# GUI版開発計画書

## 概要

キーボードモニターのGUI版開発の詳細計画書です。フェーズ1のコンソール版機能をベースに、**統合分析画面を中心とした**視覚的で使いやすいデスクトップアプリケーションを開発します。

## 開発コンセプト

### 🎯 中核機能：統合分析画面
本GUI版の中心となる「統合分析画面」は、以下の特徴を持ちます：

1. **実データ活用**: preceded_byフィールドを活用したリアルなシーケンス分析
2. **3列レイアウト**: 直前キー | メインキー | 直後キー の直感的な表示
3. **カードベース**: 情報を整理したカード形式での表示
4. **実装可能性**: 現在のデータ構造で確実に実装可能な機能に限定

## 技術仕様

### 開発環境
- **言語**: Python 3.8+
- **GUIフレームワーク**: CustomTkinter
- **テーマ**: Dark/Light モード対応
- **データ分析**: 既存のkeyboard_log.jsonを直接活用

### アーキテクチャ（統合分析画面中心）
```text
├── gui/
│   ├── main_window.py          # メインアプリケーション
│   ├── components/
│   │   ├── dashboard.py        # 基本ダッシュボード
│   │   ├── settings_panel.py   # 設定パネル
│   │   └── analytics/          # 🎯 統合分析画面（メイン機能）
│   │       ├── analytics_page.py           # 分析画面メインページ
│   │       ├── basic_stats_card.py         # 基本統計カード
│   │       ├── key_frequency_card.py       # 上位キー分析カード
│   │       ├── modifier_analysis_card.py   # モディファイア詳細カード
│   │       ├── integrated_sequence_card.py # 統合シーケンス分析カード
│   │       └── data_analyzer.py            # データ分析ロジック
│   ├── styles/
│   │   └── themes.py          # カラーテーマ定義
│   └── analytics_manager.py   # 分析データ管理
```

### データ活用戦略
現在のkeyboard_log.jsonの構造を最大限活用：
```json
{
  "total_statistics": {
    "total_keystrokes": 1041,
    "first_record_date": "2025-06-11",
    "last_record_date": "2025-06-15"
  },
  "key_statistics": {
    "72": {
      "key_name": "H",
      "count": 40,
      "modifier_combinations": {
        "none": {
          "count": 38,
          "preceded_by": { "69": 4, "84": 2, ... }  // 🎯 これを活用
        }
      }
    }
  }
}
```

## Phase 1: 基本GUIフレームワーク（✅ 完成済み）

### 完成済み機能
- [x] CustomTkinter セットアップ
- [x] メインウィンドウの設計・実装
- [x] 基本レイアウト（ダッシュボード、設定）
- [x] テーマシステム（Dark/Light）
- [x] キーボード記録の開始/停止UI
- [x] リアルタイム統計表示パネル
- [x] 基本統計情報の表示

## Phase 2: 統合分析画面の実装（🎯 メイン開発フェーズ）

### 2.1 データ分析ロジックの実装

#### 目標
現在のkeyboard_log.jsonから統合分析に必要なデータを抽出・加工する

#### 実装項目
1. **data_analyzer.py**: 分析データ処理の中核
   ```python
   def calculate_basic_stats(data)                    # 基本統計計算
   def analyze_key_frequency(data)                    # キー頻度分析
   def analyze_modifier_usage(data)                   # モディファイア分析
   def create_integrated_sequence_analysis(data)      # 統合シーケンス分析
   def get_top_predecessors(key_code, top_n=3)        # 直前キー分析
   def get_top_successors(key_code, top_n=3)          # 直後キー分析
   ```

2. **キーコード→キー名変換**: 特殊キー対応
3. **エラーハンドリング**: データ不整合時の適切な処理

### 2.2 統合分析画面レイアウトの実装

#### 目標
4つのカードで構成される統合分析画面を実装

#### レイアウト設計
```text
┌─────────────────────────────────────────────────────────────┐
│ 📈 キーボード使用統計                                        │
├─────────────────────────────────────────────────────────────┤
│ [統計更新] [データエクスポート]                              │
├─────────────────────────────────────────────────────────────┤
│ ┌─基本情報──────┐ ┌─上位キー──────┐ ┌─モディファイア詳細─┐ │
│ │総ストローク    │ │1. Space: 156回│ │Ctrl+C: 15回       │ │
│ │記録期間       │ │2. Enter: 94回 │ │Ctrl+V: 12回       │ │
│ │記録日数       │ │3. S: 95回     │ │Shift+A: 5回       │ │
│ │1日平均        │ │4. D: 80回     │ │使用率統計         │ │
│ └──────────────┘ │5. T: 70回     │ └─────────────────┘ │
│                   └──────────────┘                     │
├─────────────────────────────────────────────────────────────┤
│ ┌─統合シーケンス分析（キー中心の前後関係マップ）─────────────┐ │
│ │⬅️ 直前キー        🎯 メインキー        ➡️ 直後キー       │ │
│ │                                                        │ │
│ │（上位5キーについて、3列レイアウトで前後関係を表示）          │ │
│ └────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

#### 実装ファイル
1. **analytics_page.py**: メイン分析ページ
2. **basic_stats_card.py**: 基本統計カード
3. **key_frequency_card.py**: 上位キー分析カード
4. **modifier_analysis_card.py**: モディファイア詳細カード
5. **integrated_sequence_card.py**: 統合シーケンス分析カード（3列レイアウト）

### 2.3 メインウィンドウへの統合

#### 目標
既存のメインウィンドウに統合分析画面を追加

#### 実装項目
1. **ナビゲーション追加**: 「📊 統合分析」メニュー項目
2. **画面切り替え**: ダッシュボード ↔ 統合分析画面
3. **データ連携**: リアルタイムデータ更新との連携
- [ ] 基本ウィンドウ構造
- [ ] ナビゲーションシステム
- [ ] テーマ切り替え機能
- [ ] 既存CLIとの統合

## Phase 2.2: コア機能GUI化

### 目標
既存のCLI機能をGUIで操作可能にする

### 実装項目
#### 1. 記録制御UI
- **開始/停止ボタン**: 大きく分かりやすい制御
- **状態表示**: 記録中/停止中の視覚的表示
- **セッション情報**: 開始時刻、経過時間、キーストローク数

#### 2. システムトレイ統合
- **最小化時**: システムトレイに格納
- **クイックメニュー**: 右クリックで基本操作
- **通知**: 重要なイベントの通知

### Phase 2.2 成果物
- [ ] 記録制御GUI
- [ ] システムトレイ機能
- [ ] 基本通知システム

## Phase 2.3: 高度な視覚化

### 目標
データを美しく分かりやすいグラフで表示する

### 実装項目

#### 1. キーストローク頻度グラフ
- **棒グラフ**: 使用頻度ランキング
## Phase 3: 将来の拡張機能（オプション）

### 3.1 高度な視覚化（Phase 2.3）
**注意**: 現在は実装対象外。統合分析画面完成後に検討。

- **グラフ表示**: matplotlib統合による棒グラフ・円グラフ
- **ヒートマップ**: キーボード配列での使用頻度視覚化
- **時系列分析**: 使用パターンの時間推移

### 3.2 詳細設定とカスタマイズ（Phase 2.4）
**注意**: 基本機能完成後に実装。

- **自動起動**: Windows起動時の自動開始
- **プロファイル管理**: 複数の設定プロファイル
- **通知機能**: カスタムアラート・レポート

### 3.3 パフォーマンス最適化（Phase 2.5）
**注意**: アプリケーション完成後に実施。

- **メモリ使用量最適化**: 長時間動作対応
- **起動時間短縮**: 効率的な初期化
- **配布準備**: インストーラー作成

## 開発スケジュール

### 推定期間（統合分析画面中心）
- **Phase 1**: ✅ 完成済み（基本GUIフレームワーク）
- **Phase 2.1**: 1週間（データ分析ロジック）
- **Phase 2.2**: 2週間（統合分析画面レイアウト）
- **Phase 2.3**: 1週間（メインウィンドウ統合）

**統合分析画面完成まで**: 約4週間

### 開発優先度
1. 🎯 **最優先**: Phase 2（統合分析画面）
2. ⭐ **次期**: Phase 3.1（高度な視覚化）
3. 📋 **将来**: Phase 3.2（詳細設定）
4. 🔧 **最終**: Phase 3.3（最適化・配布）

## 品質保証

### テスト戦略
- **データ分析テスト**: 既存のkeyboard_log.jsonでの動作確認
- **UI操作テスト**: 各カードの表示・更新動作
- **統合テスト**: メインウィンドウとの連携確認
- **エラーハンドリング**: データ不整合時の適切な処理

### 成功指標
- [x] 既存CLI機能の基本GUI化
- [ ] 統合分析画面の完全実装
- [ ] preceded_byデータの完全活用
- [ ] 直感的なシーケンス分析の提供
- [ ] エラーなしでの安定動作

## リソース要件

### 追加依存関係（最小限）
- **CustomTkinter**: GUI基盤（既存）
- **既存データ**: keyboard_log.json活用
- **既存分析**: src/analyzer.py等の活用

### 開発リソース
- **新規実装**: analytics/配下のコンポーネントのみ
- **既存活用**: メインウィンドウ、設定、テーマ等は既存のまま
- **データ構造**: 現在のJSONフォーマットをそのまま活用

---

## 📊 統合分析画面の詳細仕様

### カード構成（4カード）
1. **基本統計カード**: 総ストローク、期間、日数、平均
2. **上位キー分析カード**: 使用頻度ランキング（上位5位）
3. **モディファイア詳細カード**: ショートカット統計と使用率
4. **統合シーケンス分析カード**: 3列レイアウト（直前|メイン|直後）

### データ活用方法
```python
# preceded_by活用例
"preceded_by": { "69": 4, "84": 2, "83": 1 }
# → E→H: 4回, T→H: 2回, S→H: 1回 として表示
```

### UI特徴
- **カードベース**: 情報整理された見やすいレイアウト
- **3列構成**: キー中心の前後関係マップ
- **実データ活用**: 期間選択等の未実装機能は除外
- **エラー耐性**: データ不整合時の適切なフォールバック

#### 2. 基本統計カード
- **総キーストローク数**: 記録開始からの累計
- **記録期間**: first_record_date ～ last_record_date
- **記録日数**: 日付差分による算出
- **1日平均**: 総ストローク数 ÷ 記録日数

#### 3. 上位キー分析カード
- **使用頻度ランキング**: count値による降順ソート
- **使用率表示**: 各キーの全体に対する割合
- **視覚的表示**: 棒グラフまたはプログレスバー形式

#### 4. モディファイア詳細カード
- **ショートカット使用統計**: Ctrl+C, Ctrl+V等の頻出組み合わせ
- **修飾キー使用率**: none vs shift vs ctrl vs alt の比率
- **修飾キー別ランキング**: 各修飾キーと組み合わせて使用されるキーのランキング

#### 5. 統合シーケンス分析カード
- **3列レイアウト**: 直前キー | メインキー | 直後キー
- **上位5キー対象**: 使用頻度の高いキーに絞った分析
- **前後関係マップ**: 各キーへの「入力経路」と「出力先」を可視化
- **動的更新**: データ変更時の自動反映

#### 6. データ分析ロジック
```python
# 主要な分析関数
def calculate_basic_stats(data)          # 基本統計計算
def analyze_key_frequency(data)          # キー頻度分析
def analyze_modifier_usage(data)         # モディファイア使用分析
def create_integrated_sequence_analysis(data)  # 統合シーケンス分析
def get_top_predecessors(key_code, top_n=3)    # 直前キー分析
def get_top_successors(key_code, top_n=3)      # 直後キー分析
```

#### 7. UIコンポーネント設計
- **カードベースレイアウト**: 情報を整理したカード形式
- **レスポンシブデザイン**: ウィンドウサイズに応じた調整
- **テーマ対応**: ダーク/ライトモード完全対応
- **エクスポート機能**: JSON/CSV形式でのデータ出力

### Phase 2.6 実装ファイル
- `gui/components/analytics/analytics_page.py` - メイン分析ページ
- `gui/components/analytics/basic_stats_card.py` - 基本統計カード
- `gui/components/analytics/key_frequency_card.py` - キー頻度カード
- `gui/components/analytics/modifier_analysis_card.py` - モディファイア分析カード
- `gui/components/analytics/integrated_sequence_card.py` - 統合シーケンス分析カード
- `gui/components/analytics/data_analyzer.py` - データ分析ロジック
- `gui/components/analytics_manager.py` - 分析データ管理

### Phase 2.6 成果物
- [ ] 基本統計表示機能
- [ ] キー使用頻度分析
- [ ] モディファイア詳細分析
- [ ] 統合シーケンス分析
- [ ] データエクスポート機能
- [ ] メインウィンドウへの統合
