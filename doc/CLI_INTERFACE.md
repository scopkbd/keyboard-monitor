# キーボードモニター - CLI インターフェース仕様

## 概要

このドキュメントは、キーボードモニターのコマンドラインインターフェースの詳細仕様を記載しています。

## コマンドライン引数

### 基本構文
```bash
python keyboard_monitor.py [OPTIONS]
```

### オプション一覧

| オプション | 短縮形 | 説明 | 例 |
|-----------|--------|------|-----|
| `--cli` | `-c` | CLIインタラクティブモードで起動 | `python keyboard_monitor.py --cli` |
| `--stats [date]` | `-s [date]` | 統計情報を表示（日付指定可能） | `python keyboard_monitor.py --stats 2025-06-01` |
| `--status` | `-st` | デーモンプロセスの状況を表示 | `python keyboard_monitor.py --status` |
| `--help` | `-h` | ヘルプ表示 | `python keyboard_monitor.py --help` |

## CLIインタラクティブモード（--cli）

### 起動方法
```bash
python src/keyboard_monitor.py --cli
```

### インタラクティブコマンド

| コマンド | 短縮形 | 説明 | 例 |
|----------|--------|------|-----|
| `start` | `s` | キーボード記録開始 | `> start` |
| `stop` | `t` | キーボード記録停止 | `> stop` |
| `status` | `st` | 現在の状況表示 | `> status` |
| `stats` | `stat` | 統計情報表示 | `> stats` |
| `quit` | `q` | アプリケーション終了 | `> quit` |

### リアルタイム表示情報

CLIモードでは以下の情報がリアルタイムで表示されます：

1. **記録状況**
   - 現在の状態（記録中/停止中）
   - セッション開始時刻

2. **キーストローク統計**
   - 現在セッションのキーストローク数
   - 総累積キーストローク数

3. **経過時間**
   - セッション開始からの経過時間
   - 分単位/時間単位の表示

4. **最新アクティビティ**
   - 最後に押されたキー（モディファイア含む）
   - 最後の入力時刻

### 画面表示例

```
====================================
   キーボードモニター v1.0
====================================

状態: [記録中] | 開始時刻: 2025-06-10 14:30:25
経過時間: 01:23:45

セッション統計:
  キーストローク: 1,234 回
  総累積: 25,678 回

最新アクティビティ:
  最後のキー: Ctrl+C
  時刻: 14:53:10

> _
```

## 統計表示機能（--stats）

### 基本統計表示
```bash
python keyboard_monitor.py --stats
```

**表示内容:**
- 総キーストローク数
- 記録期間（開始日〜最終日）
- 最も使用されたキー（トップ10）
- キー使用頻度の分析

### 日付指定統計
```bash
python keyboard_monitor.py --stats 2025-06-01
python keyboard_monitor.py --stats 2025-06-01:2025-06-07
```

### 統計表示例

```
====================================
   キーボード使用統計
====================================

記録期間: 2025-06-01 ～ 2025-06-10 (10日間)
総キーストローク: 25,678 回
平均（日）: 2,567.8 回

トップ10キー:
  1. Space     : 3,456 回 (13.5%) ████████████████
  2. E         : 2,890 回 (11.3%) ████████████████
  3. T         : 2,345 回 ( 9.1%) ████████████
  4. A         : 2,123 回 ( 8.3%) ███████████
  5. O         : 1,998 回 ( 7.8%) ███████████
  6. I         : 1,876 回 ( 7.3%) ██████████
  7. N         : 1,765 回 ( 6.9%) ██████████
  8. S         : 1,654 回 ( 6.4%) █████████
  9. H         : 1,543 回 ( 6.0%) █████████
 10. R         : 1,432 回 ( 5.6%) ████████

モディファイア組み合わせ:
  通常入力    : 22,345 回 (87.0%)
  Ctrl+キー   : 2,123 回 ( 8.3%)
  Shift+キー  : 987 回 ( 3.8%)
  Alt+キー    : 223 回 ( 0.9%)

頻出シーケンス（Bigram）:
  1. TH : 456 回
  2. HE : 423 回
  3. ER : 398 回
  4. AN : 367 回
  5. IN : 345 回
```

## ステータス表示機能（--status）

### 基本ステータス
```bash
python keyboard_monitor.py --status
```

**表示内容:**
- プロセス状態
- 記録状況
- データファイルの状態
- 最後の記録時刻

### ステータス表示例

```
====================================
   システムステータス
====================================

プロセス状態: 実行中
記録状態: 停止中
最後の記録: 2025-06-10 14:53:10

データファイル:
  パス: ./data/keyboard_log.json
  サイズ: 245.6 KB
  最終更新: 2025-06-10 14:53:10

メモリ使用量: 12.3 MB
CPU使用率: 0.1%
```

## エラーハンドリング

### 一般的なエラーメッセージ

1. **権限エラー**
   ```
   エラー: キーボードアクセス権限が不足しています。
   解決方法: 管理者権限で実行してください。
   ```

2. **ファイルアクセスエラー**
   ```
   エラー: データファイルにアクセスできません。
   パス: ./data/keyboard_log.json
   解決方法: ファイルの権限を確認してください。
   ```

3. **依存関係エラー**
   ```
   エラー: 必要なライブラリが見つかりません。
   不足: pynput
   解決方法: pip install -r requirements.txt を実行してください。
   ```

### ログレベル

CLIモードでは以下のログレベルで情報を表示：

- **INFO**: 通常の動作情報
- **WARNING**: 注意が必要な状況
- **ERROR**: エラー発生時
- **DEBUG**: デバッグ情報（詳細モード時）

## 設定オプション

### 設定ファイル: `config.json`

```json
{
  "logging": {
    "data_file": "./data/keyboard_log.json",
    "backup_interval": 3600,
    "max_sequence_length": 1000
  },
  "display": {
    "refresh_interval": 1.0,
    "color_output": true,
    "show_realtime": true
  },
  "privacy": {
    "exclude_passwords": true,
    "anonymize_data": false
  }
}
```

### 設定変更方法

```bash
# 設定ファイルの編集
nano config.json

# または設定コマンドで変更
python keyboard_monitor.py --config set logging.backup_interval 7200
```

## GUI統合テストスクリプト

### 統合分析テスト
```bash
# 統合分析機能のテスト実行
python test_analytics_integration.py
```

**テスト内容:**
- 統合分析ページの表示テスト
- データファイル読み込みテスト
- 各分析カードの動作確認
- ステータスバー表示確認
